<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Company Registration API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 10px 0; }
        label { display: inline-block; width: 150px; }
        input, textarea { width: 300px; padding: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>Test Company Registration API</h1>
    
    <h2>Company Information</h2>
    <div class="form-group">
        <label>Company Name:</label>
        <input type="text" id="companyName" value="Test Company Ltd" required>
    </div>
    <div class="form-group">
        <label>Description:</label>
        <textarea id="description">Test company for API testing</textarea>
    </div>
    <div class="form-group">
        <label>Address:</label>
        <input type="text" id="address" value="123 Test Street" required>
    </div>
    <div class="form-group">
        <label>City:</label>
        <input type="text" id="city" value="Test City">
    </div>
    <div class="form-group">
        <label>State:</label>
        <input type="text" id="state" value="TX">
    </div>
    <div class="form-group">
        <label>ZIP Code:</label>
        <input type="text" id="zipCode" value="12345">
    </div>
    <div class="form-group">
        <label>Country:</label>
        <input type="text" id="country" value="United States">
    </div>
    <div class="form-group">
        <label>Phone:</label>
        <input type="text" id="phone" value="555-0123">
    </div>
    <div class="form-group">
        <label>Company Email:</label>
        <input type="email" id="companyEmail" value="company@test.com">
    </div>
    <div class="form-group">
        <label>Website:</label>
        <input type="url" id="website" value="https://test.com">
    </div>
    <div class="form-group">
        <label>Tax ID:</label>
        <input type="text" id="taxId" value="12-345678">
    </div>
    <div class="form-group">
        <label>Registration #:</label>
        <input type="text" id="registrationNumber" value="REG123456">
    </div>
    <div class="form-group">
        <label>Established Date:</label>
        <input type="date" id="establishedDate" value="2024-01-01">
    </div>
    
    <h2>User Information</h2>
    <div class="form-group">
        <label>Username:</label>
        <input type="text" id="username" value="" required>
    </div>
    <div class="form-group">
        <label>Email:</label>
        <input type="email" id="email" value="" required>
    </div>
    <div class="form-group">
        <label>Password:</label>
        <input type="password" id="password" value="1q2w3E*" required>
    </div>
    
    <button onclick="testAPI()">Create Company and User</button>
    
    <div id="result" class="result" style="display: none;"></div>

    <script>
        // Generate unique username and email on page load
        window.onload = function() {
            const timestamp = new Date().toISOString().replace(/[:-]/g, '').substr(0, 15);
            document.getElementById('username').value = 'testuser_' + timestamp;
            document.getElementById('email').value = 'testuser_' + timestamp + '@test.com';
        };

        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.innerHTML = 'Testing API...';
            
            const requestData = {
                companyName: document.getElementById('companyName').value,
                description: document.getElementById('description').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zipCode: document.getElementById('zipCode').value,
                country: document.getElementById('country').value,
                phone: document.getElementById('phone').value,
                companyEmail: document.getElementById('companyEmail').value,
                website: document.getElementById('website').value,
                taxId: document.getElementById('taxId').value,
                registrationNumber: document.getElementById('registrationNumber').value,
                establishedDate: document.getElementById('establishedDate').value + 'T00:00:00',
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            try {
                const response = await fetch('/api/registration/company-and-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (response.ok && result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>Success!</h3>
                        <p><strong>Company ID:</strong> ${result.companyId}</p>
                        <p><strong>User ID:</strong> ${result.userId}</p>
                        <p><strong>Username:</strong> ${result.username}</p>
                        <p><strong>Email:</strong> ${result.email}</p>
                        <p><strong>Message:</strong> ${result.message}</p>
                        <p>You can now login with username: <strong>${result.username}</strong> and password: <strong>1q2w3E*</strong></p>
                        <p><a href="/Account/Login" target="_blank">Go to Login Page</a></p>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <h3>Error</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Error:</strong> ${result.error || 'Unknown error'}</p>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>Network Error</h3>
                    <p>${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>