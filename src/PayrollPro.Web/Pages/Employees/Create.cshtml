@page
@using PayrollPro.Employees
@using PayrollPro.Web.Pages.Employees
@model PayrollPro.Web.Pages.Employees.CreateModel
@{
    ViewData["Title"] = "Add New Employee";
}

@section styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="~/css/employee-create-modern.css">
}

<div class="employee-profile-container">
    <div class="profile-card">
        <div class="profile-header">
            <button type="button" class="back-button" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <h1><i class="fas fa-user-plus me-2"></i>Create New Employee</h1>
            <p class="subtitle">Add a new team member to your organization</p>
        </div>
        
        <div class="profile-content">
            <div class="profile-sidebar">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <h3 id="preview-name">New Employee</h3>
                    <p class="role" id="preview-position">Position</p>
                    <span class="status-badge">
                        <i class="fas fa-circle me-1"></i>Creating Profile
                    </span>
                </div>
                
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-label">Employee Code</span>
                        <span class="stat-value" id="preview-code">Auto-generated</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Department</span>
                        <span class="stat-value" id="preview-department">Not specified</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Manager</span>
                        <span class="stat-value" id="preview-manager">Not assigned</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Hire Date</span>
                        <span class="stat-value" id="preview-hire-date">Today</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Billing Rate</span>
                        <span class="stat-value" id="preview-billing">Not set</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Status</span>
                        <span class="stat-value">Active</span>
                    </div>
                </div>
            </div>
            
            <div class="profile-main">
                <form id="employeeForm" method="post" asp-antiforgery="true">
                    <input type="hidden" asp-for="Employee.CompanyId" />
                    
                    <div class="tab-navigation">
                        <button type="button" class="tab-button active" data-tab="personal">
                            <i class="fas fa-user me-2"></i>Personal Info
                        </button>
                        <button type="button" class="tab-button" data-tab="employment">
                            <i class="fas fa-briefcase me-2"></i>Employment
                        </button>
                        <button type="button" class="tab-button" data-tab="contact">
                            <i class="fas fa-envelope me-2"></i>Contact
                        </button>
                    </div>
                    
                    <!-- Personal Information Tab -->
                    <div class="tab-content active" id="personal-tab">
                        <div class="form-section">
                            <h4><i class="fas fa-id-card"></i>Basic Information</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.FirstName" placeholder=" " required />
                                    <label class="form-label">* First Name</label>
                                    <span asp-validation-for="Employee.FirstName" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.LastName" placeholder=" " required />
                                    <label class="form-label">* Last Name</label>
                                    <span asp-validation-for="Employee.LastName" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.DisplayName" placeholder=" " />
                                    <label class="form-label">Display Name As</label>
                                    <span asp-validation-for="Employee.DisplayName" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="email" class="form-control" asp-for="Employee.Email" placeholder=" " required />
                                    <label class="form-label">* Email</label>
                                    <span asp-validation-for="Employee.Email" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.Phone" placeholder=" " />
                                    <label class="form-label">Phone</label>
                                    <span asp-validation-for="Employee.Phone" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.MobilePhone" placeholder=" " />
                                    <label class="form-label">Mobile</label>
                                    <span asp-validation-for="Employee.MobilePhone" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.SocialSecurityNumber" placeholder=" " />
                                    <label class="form-label">Social Security No.</label>
                                    <span asp-validation-for="Employee.SocialSecurityNumber" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <div class="select-wrapper">
                                        <select class="form-select" asp-for="Employee.Gender">
                                            <option value="">Select Gender</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                            <option value="Prefer not to say">Prefer not to say</option>
                                        </select>
                                    </div>
                                    <span asp-validation-for="Employee.Gender" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="date" class="form-control" asp-for="Employee.DateOfBirth" />
                                    <label class="form-label">Date of Birth</label>
                                    <span asp-validation-for="Employee.DateOfBirth" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Employment Information Tab -->
                    <div class="tab-content" id="employment-tab">
                        <div class="form-section">
                            <h4><i class="fas fa-building"></i>Employment Details</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.EmployeeId" placeholder=" " required />
                                    <label class="form-label">* Employee ID</label>
                                    <span asp-validation-for="Employee.EmployeeId" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.Position" placeholder=" " required />
                                    <label class="form-label">* Position</label>
                                    <span asp-validation-for="Employee.Position" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.Department" placeholder=" " required />
                                    <label class="form-label">* Department</label>
                                    <span asp-validation-for="Employee.Department" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.Manager" placeholder=" " />
                                    <label class="form-label">Manager</label>
                                    <span asp-validation-for="Employee.Manager" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="date" class="form-control" asp-for="Employee.HireDate" required />
                                    <label class="form-label">* Hire Date</label>
                                    <span asp-validation-for="Employee.HireDate" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="date" class="form-control" asp-for="Employee.ReleaseDate" />
                                    <label class="form-label">Release Date</label>
                                    <span asp-validation-for="Employee.ReleaseDate" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <div class="select-wrapper">
                                        <select class="form-select" asp-for="Employee.Status" required>
                                            <option value="">Select Status</option>
                                            <option value="0">Active</option>
                                            <option value="1">Inactive</option>
                                            <option value="2">Terminated</option>
                                        </select>
                                    </div>
                                    <span asp-validation-for="Employee.Status" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4><i class="fas fa-dollar-sign"></i>Compensation & Billing</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="number" class="form-control" asp-for="Employee.Salary" placeholder="0.00" step="0.01" required />
                                        <span class="input-group-text">USD/year</span>
                                    </div>
                                    <span asp-validation-for="Employee.Salary" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="number" class="form-control" asp-for="Employee.BillingRate" placeholder="0.00" step="0.01" />
                                        <span class="input-group-text">USD/hr</span>
                                    </div>
                                    <span asp-validation-for="Employee.BillingRate" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <div class="form-check-wrapper">
                                        <input type="checkbox" class="form-check-input" asp-for="Employee.BillableByDefault" id="billableCheck" />
                                        <label class="form-check-label" for="billableCheck">Billable by Default</label>
                                    </div>
                                    <span asp-validation-for="Employee.BillableByDefault" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Information Tab -->
                    <div class="tab-content" id="contact-tab">
                        <div class="form-section">
                            <h4><i class="fas fa-map-marker-alt"></i>Address Information</h4>
                            <div class="form-grid">
                                <div class="form-group form-grid-full">
                                    <input type="text" class="form-control" asp-for="Employee.Address" placeholder=" " />
                                    <label class="form-label">Street Address</label>
                                    <span asp-validation-for="Employee.Address" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.City" placeholder=" " />
                                    <label class="form-label">City</label>
                                    <span asp-validation-for="Employee.City" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.State" placeholder=" " />
                                    <label class="form-label">State/Province</label>
                                    <span asp-validation-for="Employee.State" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.ZipCode" placeholder=" " />
                                    <label class="form-label">ZIP/Postal Code</label>
                                    <span asp-validation-for="Employee.ZipCode" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.Country" placeholder=" " />
                                    <label class="form-label">Country</label>
                                    <span asp-validation-for="Employee.Country" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4><i class="fas fa-phone"></i>Emergency Contact</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.EmergencyContactName" placeholder=" " />
                                    <label class="form-label">Emergency Contact Name</label>
                                    <span asp-validation-for="Employee.EmergencyContactName" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <input type="text" class="form-control" asp-for="Employee.EmergencyContactPhone" placeholder=" " />
                                    <label class="form-label">Emergency Contact Phone</label>
                                    <span asp-validation-for="Employee.EmergencyContactPhone" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4><i class="fas fa-sticky-note"></i>Additional Information</h4>
                            <div class="form-grid">
                                <div class="form-group form-grid-full">
                                    <textarea class="form-control" asp-for="Employee.Notes" placeholder=" " rows="4"></textarea>
                                    <label class="form-label">Notes</label>
                                    <span asp-validation-for="Employee.Notes" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Create Employee
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/libs/jquery/dist/jquery.min.js"></script>
    <script src="~/libs/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/libs/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script>
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(targetTab + '-tab').classList.add('active');
            });
        });
        
        function updatePreview() {
            const firstName = document.querySelector('[name="Employee.FirstName"]').value || 'New';
            const lastName = document.querySelector('[name="Employee.LastName"]').value || 'Employee';
            const displayName = document.querySelector('[name="Employee.DisplayName"]').value;
            const position = document.querySelector('[name="Employee.Position"]').value || 'Position';
            const department = document.querySelector('[name="Employee.Department"]').value || 'Not specified';
            const employeeId = document.querySelector('[name="Employee.EmployeeId"]').value || 'Auto-generated';
            const hireDate = document.querySelector('[name="Employee.HireDate"]').value || 'Today';
            const manager = document.querySelector('[name="Employee.Manager"]').value || 'Not assigned';
            const billingRate = document.querySelector('[name="Employee.BillingRate"]').value;
            
            // Update preview with display name preference
            const nameToShow = displayName && displayName.trim() ? displayName : `${firstName} ${lastName}`;
            document.getElementById('preview-name').textContent = nameToShow;
            document.getElementById('preview-position').textContent = position;
            document.getElementById('preview-department').textContent = department;
            document.getElementById('preview-code').textContent = employeeId;
            document.getElementById('preview-hire-date').textContent = hireDate ? new Date(hireDate).toLocaleDateString() : 'Today';
            
            // Add manager info to preview if available
            const managerStat = document.querySelector('#preview-manager');
            if (managerStat) {
                managerStat.textContent = manager;
            }
            
            // Add billing rate if available
            const billingStat = document.querySelector('#preview-billing');
            if (billingStat && billingRate) {
                billingStat.textContent = `$${billingRate}/hr`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });
            updatePreview();
        });
        
        // Enhanced form submission with validation
        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            if (!this.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
                
                Swal.fire({
                    icon: 'error',
                    title: 'Validation Error',
                    text: 'Please fill in all required fields correctly.',
                    confirmButtonColor: '#007bff'
                });
                
                this.classList.add('was-validated');
                return false;
            }
            
            e.preventDefault();
            
            Swal.fire({
                title: 'Creating Employee...',
                text: 'Please wait while we process your request.',
                allowOutsideClick: false,
                showConfirmButton: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            // Submit the form after showing loading
            setTimeout(() => {
                this.submit();
            }, 500);
        });
    </script>
}
