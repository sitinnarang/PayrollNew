@page
@using PayrollPro.Companies
@using PayrollPro.Web.Pages.Companies
@model CreateModalModel

<div class="modal-header bg-primary text-white">
    <h5 class="modal-title">
        <i class="fas fa-building me-2"></i>
        Add New Company
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>

<form method="post" id="CompanyCreateForm">
    <div class="modal-body">
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.Name" class="form-label">Company Name *</label>
                    <input asp-for="Company.Name" class="form-control" placeholder="Enter company name">
                    <span asp-validation-for="Company.Name" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.Code" class="form-label">Company Code</label>
                    <input asp-for="Company.Code" class="form-control" placeholder="Auto-generated if empty">
                    <span asp-validation-for="Company.Code" class="text-danger"></span>
                </div>
            </div>
        </div>
        
        <div class="mb-3">
            <label asp-for="Company.Description" class="form-label">Description</label>
            <textarea asp-for="Company.Description" class="form-control" rows="3" placeholder="Brief description of the company"></textarea>
            <span asp-validation-for="Company.Description" class="text-danger"></span>
        </div>
        
        <div class="mb-3">
            <label asp-for="Company.Address" class="form-label">Address *</label>
            <textarea asp-for="Company.Address" class="form-control" rows="2" placeholder="Enter full address"></textarea>
            <span asp-validation-for="Company.Address" class="text-danger"></span>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.City" class="form-label">City</label>
                    <input asp-for="Company.City" class="form-control" placeholder="Enter city">
                    <span asp-validation-for="Company.City" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.State" class="form-label">State/Province</label>
                    <input asp-for="Company.State" class="form-control" placeholder="Enter state or province">
                    <span asp-validation-for="Company.State" class="text-danger"></span>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.ZipCode" class="form-label">ZIP/Postal Code</label>
                    <input asp-for="Company.ZipCode" class="form-control" placeholder="Enter ZIP or postal code">
                    <span asp-validation-for="Company.ZipCode" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.Country" class="form-label">Country</label>
                    <input asp-for="Company.Country" class="form-control" placeholder="Enter country">
                    <span asp-validation-for="Company.Country" class="text-danger"></span>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.Phone" class="form-label">Phone Number</label>
                    <input asp-for="Company.Phone" class="form-control" placeholder="Enter phone number">
                    <span asp-validation-for="Company.Phone" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.Email" class="form-label">Email Address</label>
                    <input asp-for="Company.Email" type="email" class="form-control" placeholder="Enter email address">
                    <span asp-validation-for="Company.Email" class="text-danger"></span>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.Website" class="form-label">Website</label>
                    <input asp-for="Company.Website" type="url" class="form-control" placeholder="https://example.com">
                    <span asp-validation-for="Company.Website" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.EstablishedDate" class="form-label">Established Date *</label>
                    <input asp-for="Company.EstablishedDate" type="date" class="form-control">
                    <span asp-validation-for="Company.EstablishedDate" class="text-danger"></span>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.TaxId" class="form-label">Tax ID</label>
                    <input asp-for="Company.TaxId" class="form-control" placeholder="Enter tax ID">
                    <span asp-validation-for="Company.TaxId" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label asp-for="Company.RegistrationNumber" class="form-label">Registration Number</label>
                    <input asp-for="Company.RegistrationNumber" class="form-control" placeholder="Enter registration number">
                    <span asp-validation-for="Company.RegistrationNumber" class="text-danger"></span>
                </div>
            </div>
        </div>
        
        <div class="mb-3">
            <label asp-for="Company.LogoUrl" class="form-label">Logo URL</label>
            <input asp-for="Company.LogoUrl" type="url" class="form-control" placeholder="https://example.com/logo.png">
            <span asp-validation-for="Company.LogoUrl" class="text-danger"></span>
        </div>
        
        <div class="mb-3">
            <div class="form-check">
                <input asp-for="Company.IsActive" class="form-check-input" type="checkbox">
                <label asp-for="Company.IsActive" class="form-check-label">
                    Active Company
                </label>
            </div>
        </div>
    </div>
    
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i> Cancel
        </button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i> Create Company
        </button>
    </div>
</form>

<script>
    $(function() {
        $('#CompanyCreateForm').on('submit', function(e) {
            e.preventDefault();
            
            var formData = $(this).serialize();
            
            $.post($(this).attr('action') || window.location.pathname, formData)
                .done(function(response) {
                    if (response.success) {
                        $('#CompanyCreateModal').modal('hide');
                        location.reload(); // Refresh the page to show new company
                    } else {
                        // Handle validation errors
                        console.error('Validation errors:', response.errors);
                    }
                })
                .fail(function(xhr) {
                    console.error('Error creating company:', xhr.responseText);
                    Swal.fire({
                        icon: 'error',
                        title: 'Creation Failed',
                        text: 'Error creating company. Please try again.',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 4000
                    });
                });
        });
    });
</script>